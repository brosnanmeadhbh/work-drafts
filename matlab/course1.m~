
% pdf4D method for reading the data
% see detailed instructions on http://biomag.wikidot.com/msi-matlab

% follow instructions line by line. mark a line and press F9 to run it.

% change directory (cd) to where the data is, MEGcourse/oddball
cd MEGcourse/oddball

% create a pdf (processed data file, no acrobat reader) object
pdf=pdf4D('c,rfhp0.1Hz'); 

% check the channel index for channel A245
chan='A240';
chi=channel_index(pdf,chan,'name');

% read the channel from sample 1 to 10173 (about 10s)
data1 = read_data_block(pdf,[1 10173],chi);

% read A245 of the cleaned file.
cleanpdf=pdf4D('xc,hb,lf_c,rfhp0.1Hz'); 
data2=read_data_block(cleanpdf,[1 10173],chi);

% plot the channel for original and cleaned files
timeline=0:(1/1017.25):10;
plot(timeline,data1,'r')
hold on
plot(timeline,data2,'b')
xlabel ('Time in Seconds');
ylabel('Amplitude, Tesla');
title(chan)
legend ('original','cleaned')

% calculate power spectrum

[data1PSD, freq] = allSpectra(A245,1017.25,1,'FFT');
[data2PSD, freq] = allSpectra(A245cl,1017.25,1,'FFT');
figure;plot (freq(1,1:401),data1PSD(1,1:401),'r')
hold on;
plot (freq(1,1:401),data2PSD(1,1:401),'b')
xlabel ('Frequency Hz');
ylabel('SQRT(PSD), T/sqrt(Hz)');
title('Mean PSD for A245');

