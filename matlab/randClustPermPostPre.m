function [critClustSize,critT]=randClustPermPostPre(n)
clustSize=zeros(n,1);
if exist('tMinMax.txt','file')
    !rm tMinMax.txt
end
for permi=1:n
    if exist('TTnew+tlrc.BRIK','file')
        !rm TTnew+tlrc*
    end
    rnd1=round(rand(1,18)+1);
    rnd2=rnd1*-1+3;
    
    
    command = ['~/abin/3dttest++ -paired -no1sam -mask ~/SAM_BIU/docs/MASKbrain+tlrc ',...
        '-setA r1 ',...
        'sub05v1 quad0501/alpha',num2str(rnd1(1)),'+tlrc ',...
        'sub06v1 quad0601/alpha',num2str(rnd1(2)),'+tlrc ',...
        'sub07v1 quad0701/alpha',num2str(rnd1(3)),'+tlrc ',...
        'sub09v1 quad0901/alpha',num2str(rnd1(4)),'+tlrc ',...
        'sub10v1 quad1001/alpha',num2str(rnd1(5)),'+tlrc ',...
        'sub14v1 quad1401/alpha',num2str(rnd1(6)),'+tlrc ',...
        'sub15v1 quad1501/alpha',num2str(rnd1(7)),'+tlrc ',...
        'sub16v1 quad1601/alpha',num2str(rnd1(8)),'+tlrc ',...
        'sub18v1 quad1801/alpha',num2str(rnd1(9)),'+tlrc ',...
        'sub05v1 quad0502/alpha',num2str(rnd1(10)),'+tlrc ',...
        'sub06v1 quad0602/alpha',num2str(rnd1(11)),'+tlrc ',...
        'sub07v1 quad0702/alpha',num2str(rnd1(12)),'+tlrc ',...
        'sub09v1 quad0902/alpha',num2str(rnd1(13)),'+tlrc ',...
        'sub10v1 quad1002/alpha',num2str(rnd1(14)),'+tlrc ',...
        'sub14v1 quad1402/alpha',num2str(rnd1(15)),'+tlrc ',...
        'sub15v1 quad1502/alpha',num2str(rnd1(16)),'+tlrc ',...
        'sub16v1 quad1602/alpha',num2str(rnd1(17)),'+tlrc ',...
        'sub18v1 quad1802/alpha',num2str(rnd1(18)),'+tlrc ',...
        '-setB r2 ',...
        'sub05v1 quad0501/alpha',num2str(rnd2(1)),'+tlrc ',...
        'sub06v1 quad0601/alpha',num2str(rnd2(2)),'+tlrc ',...
        'sub07v1 quad0701/alpha',num2str(rnd2(3)),'+tlrc ',...
        'sub09v1 quad0901/alpha',num2str(rnd2(4)),'+tlrc ',...
        'sub10v1 quad1001/alpha',num2str(rnd2(5)),'+tlrc ',...
        'sub14v1 quad1401/alpha',num2str(rnd2(6)),'+tlrc ',...
        'sub15v1 quad1501/alpha',num2str(rnd2(7)),'+tlrc ',...
        'sub16v1 quad1601/alpha',num2str(rnd2(8)),'+tlrc ',...
        'sub18v1 quad1801/alpha',num2str(rnd2(9)),'+tlrc ',...
        'sub05v1 quad0502/alpha',num2str(rnd2(10)),'+tlrc ',...
        'sub06v1 quad0602/alpha',num2str(rnd2(11)),'+tlrc ',...
        'sub07v1 quad0702/alpha',num2str(rnd2(12)),'+tlrc ',...
        'sub09v1 quad0902/alpha',num2str(rnd2(13)),'+tlrc ',...
        'sub10v1 quad1002/alpha',num2str(rnd2(14)),'+tlrc ',...
        'sub14v1 quad1402/alpha',num2str(rnd2(15)),'+tlrc ',...
        'sub15v1 quad1502/alpha',num2str(rnd2(16)),'+tlrc ',...
        'sub16v1 quad1602/alpha',num2str(rnd2(17)),'+tlrc ',...
        'sub18v1 quad1802/alpha',num2str(rnd2(18)),'+tlrc '];
    [~, ~] = unix(command);
    
    % !~/abin/3dExtrema -volume -closure -data_thr 3 TTnew+tlrc[1]
    % !~/abin/3dExtrema -volume -closure -data_thr 3 -minima TTnew+tlrc[1]
    % !~/abin/3dExtrema -volume -closure -data_thr 3 -minima -output min TTnew+tlrc[1]
    !~/abin/3dBrickStat -min -max TTnew+tlrc'[1]' >> tMinMax.txt
    !~/abin/3dcalc -a TTnew+tlrc'[1]' -exp 'ispositive(a-3)*a' -prefix pos
    !~/abin/3dcalc -a TTnew+tlrc'[1]' -exp '-1*isnegative(a+3)*a' -prefix neg
    
    !~/abin/3dclust -quiet -1clip 3 5 125 neg+tlrc > negClust.txt
    !~/abin/3dclust -quiet -1clip 3 5 125 pos+tlrc > posClust.txt
    negClust=importdata('negClust.txt');
    posClust=importdata('posClust.txt');
    if iscell(negClust)
        negClustSize=0;
    else
        negClustSize=negClust(1)/125;
    end
    if iscell(posClust)
        posClustSize=0;
    else
        posClustSize=posClust(1)/125;
    end
    
    clustSize(permi,1)=max([negClustSize,posClustSize]);
    !rm neg+tlrc*
    !rm pos+tlrc*
end

clustSize=sort(clustSize,'descend');
% take the 5% greatest volumes (in voxels) as critical cluster size
critClustSize=clustSize(ceil(0.05*n));
% take the 5% extreme (max and -1*min) t values as criticat t
tList=importdata('tMinMax.txt');
tList=[-tList(:,1);tList(:,2)];
tList=sort(tList,'descend');
critT=tList(ceil(0.05*n*2));


rnd1=ones(1,18);
rnd2=rnd1+1;
command = ['~/abin/3dttest++ -paired -no1sam -prefix Post_Pre -mask ~/SAM_BIU/docs/MASKbrain+tlrc ',...
        '-setA r1 ',...
        'sub05v1 quad0501/alpha',num2str(rnd1(1)),'+tlrc ',...
        'sub06v1 quad0601/alpha',num2str(rnd1(2)),'+tlrc ',...
        'sub07v1 quad0701/alpha',num2str(rnd1(3)),'+tlrc ',...
        'sub09v1 quad0901/alpha',num2str(rnd1(4)),'+tlrc ',...
        'sub10v1 quad1001/alpha',num2str(rnd1(5)),'+tlrc ',...
        'sub14v1 quad1401/alpha',num2str(rnd1(6)),'+tlrc ',...
        'sub15v1 quad1501/alpha',num2str(rnd1(7)),'+tlrc ',...
        'sub16v1 quad1601/alpha',num2str(rnd1(8)),'+tlrc ',...
        'sub18v1 quad1801/alpha',num2str(rnd1(9)),'+tlrc ',...
        'sub05v1 quad0502/alpha',num2str(rnd1(10)),'+tlrc ',...
        'sub06v1 quad0602/alpha',num2str(rnd1(11)),'+tlrc ',...
        'sub07v1 quad0702/alpha',num2str(rnd1(12)),'+tlrc ',...
        'sub09v1 quad0902/alpha',num2str(rnd1(13)),'+tlrc ',...
        'sub10v1 quad1002/alpha',num2str(rnd1(14)),'+tlrc ',...
        'sub14v1 quad1402/alpha',num2str(rnd1(15)),'+tlrc ',...
        'sub15v1 quad1502/alpha',num2str(rnd1(16)),'+tlrc ',...
        'sub16v1 quad1602/alpha',num2str(rnd1(17)),'+tlrc ',...
        'sub18v1 quad1802/alpha',num2str(rnd1(18)),'+tlrc ',...
        '-setB r2 ',...
        'sub05v1 quad0501/alpha',num2str(rnd2(1)),'+tlrc ',...
        'sub06v1 quad0601/alpha',num2str(rnd2(2)),'+tlrc ',...
        'sub07v1 quad0701/alpha',num2str(rnd2(3)),'+tlrc ',...
        'sub09v1 quad0901/alpha',num2str(rnd2(4)),'+tlrc ',...
        'sub10v1 quad1001/alpha',num2str(rnd2(5)),'+tlrc ',...
        'sub14v1 quad1401/alpha',num2str(rnd2(6)),'+tlrc ',...
        'sub15v1 quad1501/alpha',num2str(rnd2(7)),'+tlrc ',...
        'sub16v1 quad1601/alpha',num2str(rnd2(8)),'+tlrc ',...
        'sub18v1 quad1801/alpha',num2str(rnd2(9)),'+tlrc ',...
        'sub05v1 quad0502/alpha',num2str(rnd2(10)),'+tlrc ',...
        'sub06v1 quad0602/alpha',num2str(rnd2(11)),'+tlrc ',...
        'sub07v1 quad0702/alpha',num2str(rnd2(12)),'+tlrc ',...
        'sub09v1 quad0902/alpha',num2str(rnd2(13)),'+tlrc ',...
        'sub10v1 quad1002/alpha',num2str(rnd2(14)),'+tlrc ',...
        'sub14v1 quad1402/alpha',num2str(rnd2(15)),'+tlrc ',...
        'sub15v1 quad1502/alpha',num2str(rnd2(16)),'+tlrc ',...
        'sub16v1 quad1602/alpha',num2str(rnd2(17)),'+tlrc ',...
        'sub18v1 quad1802/alpha',num2str(rnd2(18)),'+tlrc ']
    [~, ~] = unix(command);

% if exist('tV1V2+tlrc.BRIK')
%     !rm tV1V2+tlrc.*
% end
% unix(['~/abin/3dttest++ -paired -prefix tV1V2 -no1sam -mask ~/SAM_BIU/docs/MASKbrain+tlrc ',...
%     '-setA V1 ',...
%     'sub05v1 quad0501/alpha2+tlrc ',...
%     'sub06v1 quad0601/alpha2+tlrc ',...
%     'sub07v1 quad0701/alpha2+tlrc ',...
%     'sub09v1 quad0901/alpha2+tlrc ',...
%     'sub10v1 quad1001/alpha2+tlrc ',...
%     'sub14v1 quad1401/alpha2+tlrc ',...
%     'sub15v1 quad1501/alpha2+tlrc ',...
%     'sub16v1 quad1601/alpha2+tlrc ',...
%     'sub18v1 quad1801/alpha2+tlrc ',...
%     '-setB V2 ',...
%     'sub05v2 quad0502/alpha2+tlrc ',...
%     'sub06v2 quad0602/alpha2+tlrc ',...
%     'sub07v2 quad0702/alpha2+tlrc ',...
%     'sub09v2 quad0902/alpha2+tlrc ',...
%     'sub10v2 quad1002/alpha2+tlrc ',...
%     'sub14v2 quad1402/alpha2+tlrc ',...
%     'sub15v2 quad1502/alpha2+tlrc ',...
%     'sub16v2 quad1602/alpha2+tlrc ',...
%     'sub18v2 quad1802/alpha2+tlrc']);
